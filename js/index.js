jQuery(document).ready(function(){$('#galleryTabs').tabs();$('#dialogBox').dialog({width:420,autoOpen:false,title:'Minecraft Inventory Editor',buttons:{Ok:function(){$(this).dialog('close');refreshDropQtys();return false;}}});$('#helpBox').dialog({width:700,autoOpen:false,title:'Minecraft Inventory Editor Help',buttons:{Ok:function(){$(this).dialog('close');return false;}}});$('#helpButton').click(function(){$('#helpBox').dialog('open');return false;});$('#loadButton').button({icons:{primary:"ui-icon-folder-open"}});$('#saveButton').button({icons:{primary:"ui-icon-disk"}});var levelUploader=new qq.FileUploaderBasic({button:$('#loadButton')[0],allowedExtensions:['dat'],sizeLimit:4096,minSizeLimit:80,multiple:false,debug:false,action:'receiveNBT.php',onComplete:function(id,filename,responseJSON){if(responseJSON.success){var newNBTfile=responseJSON.newNBT;$.post('readNBT.php',{NBTfile:newNBTfile},function(response){if(response=='NoInventoryFound'){$('#dialogBox').html('<h3>Your Minecraft inventory must first contain one item.</h3>').dialog('open');return false;}else eval(response);if(inventoryArray.length>=1){$.each(inventoryArray,function(){var dropMarker=$('#mark'+this.Slot);dropMarker.attr('itemid',this.id);dropMarker.attr('itemcount',this.Count);dropMarker.css({'backgroundImage':'url(images/items/'+this.id+'.png)'});});}
refreshDropQtys();$('#loadButton').removeClass('ui-state-hover');$('#saveButton').button('option','filename',newNBTfile);$('#saveButton').button('option','disabled',false);});}
return false;}});function refreshDropQtys(){$.each($('#inventoryDrop div'),function(){var itemID=$(this).attr('itemid');var itemCount=$(this).attr('itemcount');var itemQtyDisplay=$(this).find('.qty');var itemRemove=$(this).find('.del');if(itemID&&itemCount){itemQtyDisplay.html(itemCount);}
if(itemCount>=1){itemRemove.css({'backgroundImage':'url(images/trash.png)'});}else{itemRemove.css({'backgroundImage':'none'});itemQtyDisplay.html('');$(this).css({'backgroundImage':'none'});}});return true;}
$('#inventoryDrop div span.del').click(function(){$(this).parent().attr('itemid','');$(this).parent().attr('itemcount',0);refreshDropQtys();});$('#inventoryDrop div span.qty').click(function(){var parentNode=$(this).parent();var itemCount=$(this).parent().attr('itemcount');$('#dialogBox').html('<h3>Quantity:&nbsp;<span id="countDisplay">'+itemCount+'</span></h3><div id="desiredCount"></div>');$('#desiredCount').slider({value:itemCount,min:1,max:255,slide:function(event,ui){$('#countDisplay').html(ui.value);parentNode.attr('itemcount',ui.value);}});$('#dialogBox').dialog('open');});$('#galleryTabs div.galleryTab div.draggableNugget img').draggable({cursor:'move',helper:'clone'});$('#inventoryDrop div').droppable({tolerance:'pointer',activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(event,ui){var itemID=ui.helper[0].attributes['itemid'].nodeValue;var itemCount=ui.helper[0].attributes['itemcount'].nodeValue;var itemThumb=ui.helper[0].src;$(this).attr('itemid',itemID);$(this).attr('itemcount',itemCount);$(this).css({'backgroundImage':'url('+itemThumb+')'});refreshDropQtys();}});$('#saveButton').click(function(){var currentInventory=new Array;$.each($("#inventoryDrop div"),function(){var itemID=$(this).attr('itemid'),itemCount=$(this).attr('itemcount'),itemSlot=$(this).attr('id').substr(4);if(itemID){currentInventory.push({id:itemID,Count:itemCount,Slot:itemSlot});}});var filename=$('#saveButton').button('option','filename');$.post('writeNBT.php',{filename:filename,inventoryArray:currentInventory},function(response){if(response.substr(-4)=='.dat'){$('#dialogBox').html('<h3>Level data saved!</h3>'+'<a href="download/'+response+'">Right Click Here and Save Link As to Download!</a>').dialog('open');}else{$('#dialogBox').html('<h3>Error Saving Data!</h3>').dialog('open');}});return false;});});
